<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Times of Fortune</title>
    <style>
        @font-face {
            font-family: 'VT323';
            src: url('VT323-Regular.ttf') format('truetype');
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-family: 'VT323', monospace;
        }

        .game-container {
            position: relative;
            border: 4px solid #000;
        }

        canvas {
            display: block;
        }

        #score-display {
            position: absolute;
            top: 12px;
            right: 16px;
            pointer-events: none;
            z-index: 10;
            font-family: 'VT323', monospace;
            font-size: 28px;
            color: #000;
        }
    </style>
</head>

<body>

    <div class="game-container">
        <div id="score-display">Points: 0</div>
        <canvas id="gameCanvas" width="800" height="600"></canvas>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreDisplay = document.getElementById('score-display');

        const W = 800;
        const H = 600;

        // --- State ---
        let score = 0;
        let keys = {};
        let gameState = 'start'; // 'start', 'playing', 'gameover'

        // --- Load VT323 font for canvas ---
        const vt323 = new FontFace('VT323', "url('VT323-Regular.ttf')");
        vt323.load().then(font => {
            document.fonts.add(font);
        });



        // --- Player (blue ball) ---
        const player = {
            x: W / 2,
            y: H / 2,
            r: 18,
            speed: 2.2,
            color: '#4fc3f7',
            glowColor: 'rgba(79, 195, 247, 0.5)',
        };

        // --- Enemy (red ball) ---
        const enemy = {
            x: 100,
            y: 100,
            r: 20,
            vx: 1,
            vy: 0.7,
            color: '#ef5350',
            glowColor: 'rgba(239, 83, 80, 0.5)',
            shootTimer: 0,
            shootInterval: 150, // frames between shots
        };

        // --- Projectiles ---
        let projectiles = [];
        const PROJECTILE_SPEED = 2;
        const PROJECTILE_RADIUS = 6;

        // --- Input ---
        window.addEventListener('keydown', e => {
            keys[e.key] = true;
            // prevent scrolling with arrows
            if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(e.key)) {
                e.preventDefault();
            }
        });
        window.addEventListener('keyup', e => { keys[e.key] = false; });

        // --- Helpers ---
        function clamp(val, min, max) {
            return Math.max(min, Math.min(max, val));
        }

        function dist(ax, ay, bx, by) {
            return Math.hypot(bx - ax, by - ay);
        }

        function drawBall(x, y, r, color) {
            ctx.beginPath();
            ctx.arc(x, y, r, 0, Math.PI * 2);
            ctx.fillStyle = color;
            ctx.fill();
        }

        // --- Update ---
        function update() {
            // Player movement
            if (keys['ArrowUp'] || keys['w']) player.y -= player.speed;
            if (keys['ArrowDown'] || keys['s']) player.y += player.speed;
            if (keys['ArrowLeft'] || keys['a']) player.x -= player.speed;
            if (keys['ArrowRight'] || keys['d']) player.x += player.speed;

            // Clamp player inside canvas
            player.x = clamp(player.x, player.r, W - player.r);
            player.y = clamp(player.y, player.r, H - player.r);

            // Enemy movement (bouncing)
            enemy.x += enemy.vx;
            enemy.y += enemy.vy;
            if (enemy.x - enemy.r <= 0 || enemy.x + enemy.r >= W) enemy.vx *= -1;
            if (enemy.y - enemy.r <= 0 || enemy.y + enemy.r >= H) enemy.vy *= -1;
            enemy.x = clamp(enemy.x, enemy.r, W - enemy.r);
            enemy.y = clamp(enemy.y, enemy.r, H - enemy.r);

            // Enemy shooting
            enemy.shootTimer++;
            if (enemy.shootTimer >= enemy.shootInterval) {
                enemy.shootTimer = 0;
                // Aim at player
                const dx = player.x - enemy.x;
                const dy = player.y - enemy.y;
                const d = Math.hypot(dx, dy) || 1;
                projectiles.push({
                    x: enemy.x,
                    y: enemy.y,
                    vx: (dx / d) * PROJECTILE_SPEED,
                    vy: (dy / d) * PROJECTILE_SPEED,
                    r: PROJECTILE_RADIUS,
                });
            }

            // Update projectiles
            for (let i = projectiles.length - 1; i >= 0; i--) {
                const p = projectiles[i];
                p.x += p.vx;
                p.y += p.vy;

                // Check if off-screen → score!
                if (p.x + p.r < 0 || p.x - p.r > W || p.y + p.r < 0 || p.y - p.r > H) {
                    projectiles.splice(i, 1);
                    score++;
                    scoreDisplay.textContent = `Points: ${score}`;
                    continue;
                }

                // Check collision with player → game over
                if (dist(p.x, p.y, player.x, player.y) < p.r + player.r) {
                    gameOver();
                    return;
                }
            }

            // Check collision player ↔ enemy
            if (dist(player.x, player.y, enemy.x, enemy.y) < player.r + enemy.r) {
                gameOver();
                return;
            }
        }

        // --- Draw ---
        function draw() {
            // Background
            ctx.fillStyle = '#fff';
            ctx.fillRect(0, 0, W, H);

            // Enemy
            drawBall(enemy.x, enemy.y, enemy.r, enemy.color);

            // Projectiles
            for (const p of projectiles) {
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
                ctx.fillStyle = '#222';
                ctx.fill();
            }

            // Player
            drawBall(player.x, player.y, player.r, player.color);
        }

        // --- Start Screen ---
        function drawStartScreen() {
            // Background
            ctx.fillStyle = '#fff';
            ctx.fillRect(0, 0, W, H);

            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';

            ctx.fillStyle = '#000';
            ctx.font = '48px VT323, monospace';
            ctx.fillText('TIMES OF FORTUNE', W / 2, H / 2 - 60);

            ctx.fillStyle = '#000';
            ctx.font = '22px VT323, monospace';
            ctx.fillText('Dodge the enemy projectiles!', W / 2, H / 2 + 10);

            ctx.fillStyle = '#000';
            ctx.font = '26px VT323, monospace';
            ctx.fillText('[ PRESS ENTER TO START ]', W / 2, H / 2 + 70);
        }

        function startHandler(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                window.removeEventListener('keydown', startHandler);
                gameState = 'playing';
                scoreDisplay.style.display = 'block';
                loop();
            }
        }

        // --- Game Over ---
        function gameOver() {
            gameState = 'gameover';

            // Text
            ctx.fillStyle = '#000';
            ctx.font = '52px VT323, monospace';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText('GAME OVER', W / 2, H / 2 - 30);

            ctx.fillStyle = '#000';
            ctx.font = '26px VT323, monospace';
            ctx.fillText(`Your score: ${score}`, W / 2, H / 2 + 25);

            ctx.fillStyle = '#000';
            ctx.font = '22px VT323, monospace';
            ctx.fillText('Press ENTER to return to menu', W / 2, H / 2 + 65);

            window.addEventListener('keydown', restartHandler);
        }

        function restartHandler(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                window.removeEventListener('keydown', restartHandler);
                goToStartScreen();
            }
        }

        function goToStartScreen() {
            score = 0;
            scoreDisplay.textContent = 'Points: 0';
            scoreDisplay.style.display = 'none';
            player.x = W / 2;
            player.y = H / 2;
            enemy.x = 100;
            enemy.y = 100;
            enemy.vx = 1;
            enemy.vy = 0.7;
            enemy.shootTimer = 0;
            projectiles = [];
            gameState = 'start';
            drawStartScreen();
            window.addEventListener('keydown', startHandler);
        }

        // --- Loop ---
        function loop() {
            if (gameState !== 'playing') return;
            update();
            if (gameState !== 'playing') return;
            draw();
            requestAnimationFrame(loop);
        }

        // Show start screen
        scoreDisplay.style.display = 'none';
        drawStartScreen();
        window.addEventListener('keydown', startHandler);
    </script>
</body>

</html>